# kpo-hw-4

## Запуск проекта

Развертывание и запуск в докере:
```
docker compose up --build -d
```
Сваггер (интерактивная документация) микросервиса 'order':
```
http://localhost:8002/docs
```
Сваггер (интерактивная документация) микросервиса 'auth':
```
http://localhost:8001/docs
```

## Описание архитектуры
Проект состоит из двух микросервисов - сервиса авторизации (auth) и сервиса обработки заказов (order).
Микросервисы имеют очень похожую архитектуру, написаны на FastAPI (фреймворк на Python).

Каждый сервис обращается к своей базе данных, в качестве субд выбран postgres. 
Для создания таблиц (и миграций) используется alembic. Миграции находятся в папках migrations.

Для взаимодействия с базой данных выделен отдельный модуль db. 
Для выполнения запросов есть модуль db.gateway ('шлюз' с базой данных), которые выполняют всю "грязную" работу - 
выполняют запросы (insert, update, select) в базу данных, а также конвертируют "сырые" данные в объекты моделей и обратно.

В модуле model находятся модели, отвечающие за хранение данных сущностей, которыми оперирует программа 
(благодаря pydantic удобно делать первичную валидацию, а также модели автоматически сериализуются/десериализуются из json).

Есть слой logic, где находится основная логика программы.

В модуле endpoints находятся функции, соответствующие эндпоинтам сервера. 
В сервисе order есть отдельный подмодуль permissions, который определяет, имеет ли пользователь доступ к эндпоинту (для этого делается запрос к серверу авторизации).

В микросервисе order есть особенный модуль lib - для взаимодействия с посторонними сервисами, здесь находится класс клиента, 
который отправляет запросы сервису auth для авторизации пользователя по токену.

P.S. При удалении блюда оно не удаляется из базы данных, а помечается как is_available=False. Это сделано для возможности проанализировать историю заказов (так как если удалим dish, то непонятно, что делать с order_dish.dish_id (удалять order_dish - потеряем возможность анализировать историю заказов/прибыль ресторана, а делать dish_id=0 - не сможем понять при анализе, какое блюдо заказал посетитель).
